# GitHub Copilot Instructions

## Project Context

This is a Jekyll-based GitHub Pages site (`dekay2001.github.io`) serving as a personal blog with resume, yoga sequences, and playground sections. The site uses `jekyll-theme-cayman` with custom layouts, JavaScript functionality, and Jest testing.

## Repository Structure

- **Jekyll Site**: Custom layouts in `_layouts/`, includes in `_includes/`, data in `_data/`
- **Blog Posts**: Markdown files in `_posts/` with naming format `YYYY-MM-DD-title.md`
- **TypeScript Source**: Source files in `src/base/` and `src/yoga/` (DO NOT edit `assets/js/` directly - auto-generated!)
- **Compiled JavaScript**: Output in `assets/js/` with subdirectories `base/` and `yoga/` (generated by TypeScript compiler)
- **Tests**: TypeScript tests in `test/unit/` mirroring source structure (use `.test.ts` extension)
- **Content Pages**: `index.md` (home), `resume/index.md`, `yoga/index.html`, `playground/index.html`
- **Assets**: CSS in `assets/css/`, images in `assets/images/`, data files in `assets/data/`

## Development Environment

- **OS**: Windows with PowerShell
- **Ruby**: Ruby 3.4.7 (installed at C:\Ruby34-x64\bin)
- **Jekyll**: Installed via Bundler with GitHub Pages gem
- **TypeScript**: TypeScript 5.9.3 (source in `src/`, compiles to `assets/js/`)
- **Testing**: Jest with ts-jest for TypeScript testing
- **Node Dependencies**: typescript, ts-jest, @types/jest, jest, jest-environment-jsdom
- **Ruby Dependencies**: github-pages gem (includes Jekyll and all GitHub Pages dependencies)
- **Deployment**: Automatic via GitHub Pages + GitHub Actions (compiles TypeScript on push to `master`)
- **Site URL**: https://dekay2001.github.io
- **Local Development**: http://localhost:4000 (via Jekyll server)

---

## Code Generation Guidelines

### When Creating Blog Posts

- Use Jekyll naming convention: `YYYY-MM-DD-title-with-dashes.md`
- Include front matter with layout, title, and date
- Place in `_posts/` directory
- Default layout: `post`

**Template:**
```markdown
---
layout: post
title: "Your Title Here"
date: YYYY-MM-DD
---

Content starts here...
```

### When Writing TypeScript

- **CRITICAL**: Always edit TypeScript source in `src/` directory, NEVER edit compiled JavaScript in `assets/js/`
- Use ES6+ syntax with TypeScript types
- Place source files in `src/base/` or `src/yoga/` depending on purpose
- Export functions/classes with proper TypeScript types: `export function functionName(param: Type): ReturnType { }`
- Define interfaces for data structures: `interface MyData { prop: string; }`
- Follow existing patterns from `displayables.ts` and `models.ts`
- Compile TypeScript after changes: `npm run build`

**Template:**
```typescript
/**
 * @description Brief description of what this does
 */
export function myFunction(input: string): number {
  return input.length;
}

export interface MyData {
  id: number;
  name: string;
}
```

### When Writing Tests

- Create test files in `test/unit/` mirroring source structure
- Use `.test.ts` extension for TypeScript tests
- Import from **TypeScript source** (not compiled output): `import { Thing } from '../../../../../src/base/models';`
- Use Jest syntax with TypeScript: `describe()`, `test()`, `expect()`
- Add `@jest-environment jsdom` comment if DOM is needed
- Run tests before committing: `npm test -- --watchAll=false`

**Template:**
```typescript
import { myFunction } from '../../../../../src/base/example';

describe('myFunction', () => {
  test('should perform expected behavior', () => {
    expect(myFunction('test')).toBe(4);
  });
});
```

### When Modifying Layouts/Includes

- **Layouts**: Use Liquid templating with `{{ page.variable }}` and `{% include file.html %}`
- **Includes**: Small, reusable components (header, footer, navigation)
- **CSS**: Responsive styles in separate files (responsive-default.css, responsive-post.css, etc.)
- All layouts inherit from Jekyll theme but can override

### When Working with Configuration

- **_config.yml**: Site-wide settings (title, description, theme, pagination)
- Changes to `_config.yml` require Jekyll restart in local development
- Navigation structure in `_data/navigation.yml`

---

## Common Tasks & Patterns

### Creating a New Blog Post

**User Intent**: "Create a new blog post about [topic]"

**Action**: 
1. Generate filename: `_posts/YYYY-MM-DD-topic-name.md`
2. Include proper front matter with post layout
3. Add relevant content based on existing post style

### Adding JavaScript Functionality

**User Intent**: "Add a new [feature] to the yoga/playground section"

**Action**:
1. Create TypeScript file in appropriate `src/` subdirectory (e.g., `src/base/` or `src/yoga/`)
2. Export functions/classes with proper types for testing
3. Create corresponding test file in `test/unit/` with `.test.ts` extension
4. Compile TypeScript: `npm run build`
5. Run tests: `npm test -- --watchAll=false`
6. Reference compiled output in HTML: `<script src="/assets/js/path/to/file.js"></script>`

### Updating Packages

**User Intent**: "Update packages" or "check for outdated dependencies"

**Action**:
1. Suggest: `npm outdated` to check current status
2. Provide update commands using PowerShell syntax
3. Recommend: `ncu -u && npm install && npm test -- --watchAll=false`
4. Always suggest running tests after updates

### Modifying Site Styling

**User Intent**: "Change the [color/layout/style] of [element]"

**Action**:
1. Identify relevant CSS file in `assets/css/`
2. Consider responsive variants (responsive-*.css files)
3. Use existing class naming conventions
4. Test changes across layouts (default, post, resume)

---

## Testing Requirements

See "Testing Standards" in the Code Organization section below for comprehensive testing guidelines including:
- Test file structure and naming conventions
- Test-Driven Development (TDD/BDD) approach
- Arrange-Act-Assert pattern
- Coverage targets and mocking strategies

**Quick Reference:**
- **Always** compile TypeScript and run tests before committing: `npm run build && npm test -- --watchAll=false`
- Test file naming: `*.test.ts` in `test/unit/` mirroring source structure
- Use descriptive test names: `test('should [expected behavior] when [condition]')`
- Mock external dependencies (fetch, DOM, etc.)
- Aim for >80% code coverage for critical paths

---

## Git Workflow Preferences

### Commit Messages

Generate clear, descriptive commit messages:
- ✅ "Add blog post: [title]"
- ✅ "Update resume with [specific change]"
- ✅ "Fix [specific issue] in [component]"
- ✅ "Refactor [component] to [improvement]"
- ❌ "Update files"
- ❌ "Fix bug"

### Branch Strategy

- **Primary branch**: `master`
- Feature branches for major changes
- Always push to appropriate branch (currently on: `Githubinstructions`)

### Pre-commit Checklist

Before suggesting `git push`, ensure:
1. TypeScript compiles: `npm run build`
2. Tests pass: `npm test -- --watchAll=false`
3. No linting errors (if applicable)
4. Files are properly formatted
5. Commit message is descriptive

---

## File Naming Conventions

| Type | Pattern | Example |
|------|---------|---------|
| Blog Post | `YYYY-MM-DD-title.md` | `2025-11-23-copilot-instructions.md` |
| TypeScript Source | `*.ts` in `src/` | `src/base/models.ts` |
| Test File | `*.test.ts` | `models.test.ts` |
| Layout | `*.html` | `default.html`, `post.html` |
| Include | `*.html` | `footer.html`, `navheader.html` |
| Data | `*.json` or `*.yml` | `navigation.yml`, `primary-series.json` |

---

## Code Organization and Clean Code Standards

### Public Interface First (Critical)
**Always declare public interfaces at the top of modules and classes** to enable top-down reading without jumping around in code.

- **Modules**: Export statements and public functions/constants should be declared first
- **Classes**: Public methods and properties should be declared before private ones
- **Rationale**: Readers should understand the public API without scrolling through implementation details

**Example - Module Structure**:
```javascript
// ✅ CORRECT: Public interface first
export function calculateTotal(items) {
  return items.reduce((sum, item) => sum + _applyDiscount(item), 0);
}

export function formatPrice(amount) {
  return _currencyFormatter.format(amount);
}

// Private implementation details below
function _applyDiscount(item) {
  return item.price * (1 - item.discount);
}

const _currencyFormatter = new Intl.NumberFormat('en-US', {
  style: 'currency',
  currency: 'USD'
});
```

```javascript
// ❌ INCORRECT: Private details mixed with public interface
function _applyDiscount(item) {
  return item.price * (1 - item.discount);
}

export function calculateTotal(items) {
  return items.reduce((sum, item) => sum + _applyDiscount(item), 0);
}

const _currencyFormatter = new Intl.NumberFormat('en-US', {
  style: 'currency',
  currency: 'USD'
});

export function formatPrice(amount) {
  return _currencyFormatter.format(amount);
}
```

**Example - Class Structure**:
```javascript
// ✅ CORRECT: Public methods first
class DataProcessor {
  // Public interface
  constructor(config) {
    this._config = config;
    this._cache = new Map();
  }

  process(data) {
    if (this._cache.has(data.id)) {
      return this._cache.get(data.id);
    }
    return this._processAndCache(data);
  }

  clearCache() {
    this._cache.clear();
  }

  // Private methods below
  _processAndCache(data) {
    const result = this._transform(data);
    this._cache.set(data.id, result);
    return result;
  }

  _transform(data) {
    return { ...data, processed: true };
  }
}
```

### JavaScript Best Practices

**Modern JavaScript (ES6+)**:
- Use `const` by default, `let` only when reassignment needed, never `var`
- Prefer arrow functions for callbacks and non-method functions
- Use template literals for string interpolation
- Destructuring for object/array extraction
- Spread operator for object/array copying
- Default parameters instead of `||` fallbacks

**Naming Conventions**:
- `camelCase` for variables, functions, and methods
- `PascalCase` for classes and constructors
- `UPPER_SNAKE_CASE` for constants
- Prefix private methods/properties with underscore: `_privateMethod`
- Use descriptive names that reveal intent

**Function Design**:
- Keep functions small and focused (single responsibility)
- Limit parameters (3 or fewer; use object for more)
- Avoid side effects in pure functions
- Return early to reduce nesting
- Use async/await instead of promise chains

**Error Handling**:
- Always handle promise rejections
- Use try/catch with async/await
- Throw meaningful error messages
- Validate inputs early
- Don't catch errors you can't handle

**Code Organization**:
- One class per file (with same name as file)
- Group related functions in modules
- Import statements at top, grouped by type (external, internal, local)
- Maximum file length: ~300 lines (split if larger)

**Comments and Documentation**:
- Use JSDoc for public APIs
- Comment "why", not "what"
- Keep comments up-to-date with code
- Document non-obvious behavior or edge cases

### Code Review Checklist

During code reviews, **always verify**:

1. ✅ **Public interfaces declared first** in all modules and classes
2. ✅ Modern JavaScript patterns used (const/let, arrow functions, destructuring)
3. ✅ Functions are small, focused, and well-named
4. ✅ Consistent naming conventions throughout
5. ✅ Error handling present for async operations
6. ✅ No commented-out code or console.log statements
7. ✅ JSDoc comments for public APIs
8. ✅ Imports organized and grouped logically
9. ✅ No magic numbers or strings (use named constants)
10. ✅ Code is DRY (Don't Repeat Yourself)

### Anti-Patterns to Avoid

**Avoid**:
- ❌ Nested callbacks (callback hell) - use async/await
- ❌ Modifying function parameters
- ❌ Implicit type coercion (`==` instead of `===`)
- ❌ Global variables
- ❌ Large functions (>30 lines typically needs splitting)
- ❌ Deep nesting (>3 levels indicates refactoring needed)
- ❌ Mixed public/private declarations in classes
- ❌ Mixing concerns in a single function/module

### Testing Standards

**Test Development Approach:**
- Write tests before or alongside code (TDD/BDD)
- Tests should document expected behavior and serve as living documentation
- Create test files in `test/unit/` mirroring source structure

**Test File Structure:**
- Test file naming: `*.test.ts` (e.g., `blog-search.test.ts`)
- Use `@jest-environment jsdom` comment when DOM is required
- Import from **TypeScript source**: `import { Thing } from '../../../../../src/base/models';`
- Group related tests with `describe()` blocks

**Test Naming and Organization:**
- Use descriptive test names: `test('should calculate total with discount applied')`
- Alternative pattern: "should [expected behavior] when [condition]"
- Follow **Arrange-Act-Assert** pattern:
  ```javascript
  test('should return discounted price', () => {
    // Arrange: Set up test data
    const item = { price: 100, discount: 0.2 };
    
    // Act: Execute the function
    const result = calculatePrice(item);
    
    // Assert: Verify the result
    expect(result).toBe(80);
  });
  ```

**Mocking and Dependencies:**
- Mock external dependencies (fetch, DOM elements, file system)
- Use Jest mocking: `jest.fn()`, `jest.mock()`
- Mock `global.fetch` for API calls in jsdom environment
- Keep mocks simple and focused on the test's purpose

**Coverage and Quality:**
- Aim for >80% code coverage for critical paths
- Test both happy paths and edge cases
- Test error handling and validation
- Run tests before committing: `npm test -- --watchAll=false`
- Verify all tests pass before pushing changes

---

## Code Style Preferences

### JavaScript
- Use ES6+ features (arrow functions, const/let, template literals)
- Prefer functional programming patterns
- Export reusable functions and classes
- Document complex logic with comments

### Markdown
- Use ATX-style headers (`#`, `##`, etc.)
- Code blocks with language specification
- Follow existing blog post tone and structure

### HTML/Liquid
- Semantic HTML5 elements
- Liquid tags for dynamic content
- Maintain accessibility (alt text, ARIA labels where needed)

### CSS
- BEM-like naming or existing convention
- Mobile-first responsive design
- Organize by component/section

---

## Important Context for Responses

### When Asked About Site Updates
- Assume user wants changes pushed to GitHub Pages
- Remind about deployment time (1-5 minutes)
- Suggest verifying at https://dekay2001.github.io

### When Asked About Package Management
- Use PowerShell syntax (Windows environment)
- Recommend `npm-check-updates` (ncu) for bulk updates
- Always suggest testing after updates
- Consider security with `npm audit`

### When Asked About Local Development

**Two-Terminal Setup (Recommended):**

**Terminal 1 - TypeScript Watch Mode:**
```powershell
npm run build:watch
```
*Automatically recompiles TypeScript whenever you save changes to `src/` files*

**Terminal 2 - Jekyll Server:**
```powershell
bundle exec jekyll serve --livereload
```
*Serves site at http://localhost:4000 and auto-refreshes browser on changes*

**Quick Start (One-Time Build):**
```powershell
# 1. Compile TypeScript first (required!)
npm run build

# 2. Start Jekyll server
bundle exec jekyll serve

# 3. Visit http://localhost:4000
```

**Important Notes:**
- Ruby 3.4.7 is installed at C:\Ruby34-x64\bin
- May need to add Ruby to PATH: `$env:PATH += ";C:\Ruby34-x64\bin"`
- **Always compile TypeScript before starting Jekyll** - Jekyll serves compiled JavaScript from `assets/js/`, not TypeScript source
- Jekyll auto-regenerates on file changes (watch mode enabled by default)
- Changes to `_config.yml` require Jekyll restart (Ctrl+C, then restart)

**Testing Workflow:**
```powershell
# 1. Compile TypeScript
npm run build

# 2. Run tests
npm test -- --watchAll=false

# 3. Start Jekyll and test in browser
bundle exec jekyll serve
# Visit http://localhost:4000
```

### When Debugging
- Check Jest tests first
- Verify file paths (absolute vs relative)
- Consider browser caching for CSS/JS changes
- Check GitHub Actions for deployment issues

---

## Dependencies & Versions

Current package.json devDependencies:
```json
{
  "@types/jest": "^30.0.0",
  "jest": "^30.0.5",
  "jest-environment-jsdom": "^30.0.5",
  "ts-jest": "^29.4.6",
  "typescript": "^5.9.3"
}
```

**Note**: These versions may be outdated. When asked to update, suggest latest versions.

### Ruby Dependencies (Gemfile)

The project uses Bundler to manage Jekyll and GitHub Pages dependencies:
```ruby
source "https://rubygems.org"
gem "github-pages", group: :jekyll_plugins
gem "webrick"
```

The `github-pages` gem includes all dependencies needed for GitHub Pages compatibility, including Jekyll and all approved plugins.

---

## Special Sections

### Yoga Section
- Data-driven: JSON files in `assets/data/yoga/`
- Interactive sequences with JavaScript in `assets/js/yoga/`
- Main files: `main.js`, `play-sequence.js`
- Display logic in `base/displayables.js` and `base/models.js`

### Playground Section
- Experimental/demo area
- Uses `playground.js`
- More flexible than other sections

### Blog Section
- Standard Jekyll blog with pagination (4 posts per page)
- Posts dating back to 2019
- Topics: personal reflections, tech, yoga/philosophy
- Layout: `post.html`

### Resume Section
- Markdown-based: `resume/index.md`
- Custom layout: `resume.html`
- Separate responsive CSS: `responsive-resume.css`

---

## Quick Command Reference

```powershell
# TypeScript Compilation
npm run build                         # Compile TypeScript once
npm run build:watch                   # Watch mode - auto-compile on save

# Testing
npm test -- --watchAll=false           # Run tests once
npm test -- --coverage --watchAll=false # With coverage

# Package Management
npm outdated                           # Check outdated packages
ncu -u                                # Update package.json to latest
npm install                           # Install dependencies
npm audit                             # Security check

# Git
git status                            # Check status
git add .                             # Stage all changes
git commit -m "message"               # Commit
git push origin master                # Deploy to GitHub Pages

# Local Jekyll Development
$env:PATH += ";C:\Ruby34-x64\bin"     # Add Ruby to PATH (if needed)
bundle exec jekyll serve              # Start local server at http://localhost:4000
bundle exec jekyll serve --livereload # With live reload (requires wdm gem)
bundle install                        # Install/update Ruby dependencies
bundle update                         # Update all gems to latest compatible versions

# Complete Local Testing Setup (Two Terminals)
# Terminal 1:
npm run build:watch                   # Auto-compile TypeScript

# Terminal 2:
bundle exec jekyll serve --livereload # Serve site at http://localhost:4000
```

---

## Success Criteria

When completing tasks, ensure:
- ✅ Code follows existing patterns and conventions
- ✅ TypeScript compiles (if TypeScript changes)
- ✅ Tests pass (if JavaScript changes)
- ✅ Files are in correct directories
- ✅ Commit messages are descriptive
- ✅ Changes are appropriate for GitHub Pages deployment
- ✅ Responsive design considered (if CSS/HTML changes)
- ✅ No broken links or references

---

*Last Updated: December 12, 2025*
